<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Polylines测试</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="animate.css">

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        #map {
            height: 100%;
        }
        
        #load-region {
            position: absolute;
            left: 15%;
            top: 1%;
            padding: 1px 1px 1px 1px;
            z-index: 5;
        }
        
        #region {
            position: absolute;
            left: 35%;
            top: 1%;
            padding: 1px 1px 1px 1px;
            z-index: 5;
        }
        
        #submit {
            position: absolute;
            left: 55%;
            top: 1%;
            padding: 1px 1px 1px 1px;
            z-index: 5;
        }
    </style>

</head>

<body>
    <div class="row">
        <button class="btn-flat btn-warning" id="load-region">load all regions</button>
        <input type="text" id="region">
        <button class="btn-flat btn-success" id="submit">submit</button>
    </div>
    <div id="map"></div>


    <!-- jQuery 2.1.4 -->
    <script src="jQuery-2.1.4.min.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap.min.js"></script>
    <script src="d3.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAC01nTmNbpdoTQ5eu5v9vs1PpVb-Pbpq4&callback=initMap" async defer></script>
    <script src="earthsquare.js"></script>
    <script>
        var map;


        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {
                    lat: 45.427109,
                    lng: -75.679498
                },
                zoom: 9
            });

            google.maps.event.addDomListener(map, 'zoom_changed', function () {
                var zoom = map.getZoom();
                alert("zoom changed to " + zoom);
                if (zoom >= 1 && zoom <= 9) {


                } else if (zoom > 9 && zoom <= 11) {

                } else if (zoom > 11) {


                }
            });

        }

        function drawRec(row, col, color) {
            var rec = new EarthSqure();
            rec.rowColtoLatLon(row, col);
            var rectangle = new google.maps.Rectangle({
                strokeWeight: 0,
                fillColor: color,
                fillOpacity: 0.35,
                map: map,
                bounds: {
                    north: rec.north,
                    south: rec.south,
                    east: rec.east,
                    west: rec.west
                }
            });
            google.maps.event.addListener(rectangle, 'mouseover', function () {
                //alert("mouseover!");

            });
            google.maps.event.addListener(rectangle, 'mouseout', function () {
                //alert("mouseout!");
            });

        }


        function getColor(value) {
            var palegreen = d3.rgb(0, 255, 255); //浅绿
            var darkgreen = d3.rgb(0, 0, 255); //深绿
            var color = d3.interpolate(palegreen, darkgreen); //颜色插值函数
            var linear = d3.scale.linear().domain([1, 100]).range([0, 1]);
            return color(linear(value));
        }



        $("#submit").click(function () {
            var latlong = $("#region").val().split(",");
            var region = new EarthSqure();
            region.latLontoRowCol(latlong[0], latlong[1]);
            alert(region.row + "," + region.col);
        });


        $("#load-region").click(function () {

            var regions = [
                {
                    "row": 253,
                    "col": -297,
                    "value": 16
                }, {
                    "row": 253,
                    "col": -296,
                    "value": 90
                }, {
                    "row": 253,
                    "col": -295,
                    "value": 85
                }, {
                    "row": 252,
                    "col": -297,
                    "value": 47
                }, {
                    "row": 252,
                    "col": -296,
                    "value": 72
                }, {
                    "row": 252,
                    "col": -295,
                    "value": 66
                }, {
                    "row": 251,
                    "col": -297,
                    "value": 23
                }, {
                    "row": 251,
                    "col": -296,
                    "value": 43
                }, {
                    "row": 251,
                    "col": -295,
                    "value": 82
                }
            ];

            jQuery.each(regions, function () {
                drawRec(this.row, this.col, getColor(this.value));
            });



        });
    </script>
</body>

</html>